# Render.com deployment configuration for Munda Market Backend

services:
  # FastAPI Backend Service
  - type: web
    name: munda-market-api
    env: python
    runtime: python-3.11.9  # Use Python 3.11 for stable wheel support
    region: oregon  # or singapore for Africa proximity
    plan: starter  # $7/month, upgrade to standard for production
    buildCommand: "pip install --upgrade pip && pip install -r requirements-core.txt && pip install pydantic-settings"
    startCommand: "cd backend && uvicorn app.main:app --host 0.0.0.0 --port $PORT"
    rootDir: backend  # Set backend as root directory
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: munda-market-db
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
        sync: false
      - key: DEBUG
        value: false
      - key: LOG_LEVEL
        value: info
      - key: ALLOWED_HOSTS
        value: "admin.mundamarket.co.zw,buy.mundamarket.co.zw,api.mundamarket.co.zw"
      - key: API_V1_STR
        value: /api/v1
      - key: PROJECT_NAME
        value: Munda Market
      - key: PROJECT_VERSION
        value: "1.0.0"
      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: "30"
      # Payment Gateway Keys (add your actual keys)
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: ECOCASH_API_KEY
        sync: false
      - key: ZIPIT_API_KEY
        sync: false
      # WhatsApp/SMS Configuration
      - key: WHATSAPP_ACCESS_TOKEN
        sync: false
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false

# PostgreSQL Database
databases:
  - name: munda-market-db
    databaseName: munda_market
    user: munda_user
    region: oregon  # Same region as backend for low latency
    plan: starter  # $7/month (256MB), upgrade to standard for production
    postgresMajorVersion: 15

# Redis (for caching, sessions, queues)
# Note: Add this separately in Render dashboard (free 25MB plan available)


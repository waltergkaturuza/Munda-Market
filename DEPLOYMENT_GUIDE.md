# Munda Market - Deployment Guide

## ğŸš€ Production Deployment Strategy

### Architecture Overview
```
Flutter App (Google Play) â†’ FastAPI (Render.com) â† React Apps (Vercel)
                                   â†“
                            PostgreSQL (Render.com)
```

---

## 1ï¸âƒ£ Backend Deployment (Render.com)

### Prerequisites
- Render.com account (free tier available)
- GitHub repository
- Domain name (optional but recommended)

### Steps:

#### A. Create New Web Service
1. Go to [render.com](https://render.com)
2. Click **"New +"** â†’ **"Web Service"**
3. Connect your GitHub repository
4. Select the `backend` folder

#### B. Configure Service
```
Name:              munda-market-api
Environment:       Python 3
Region:            Oregon (or Singapore for better Africa latency)
Branch:            main
Root Directory:    backend
Build Command:     pip install -r requirements-core.txt && pip install pydantic-settings "bcrypt<4.0"
Start Command:     uvicorn app.main:app --host 0.0.0.0 --port $PORT
```

#### C. Create PostgreSQL Database
1. Click **"New +"** â†’ **"PostgreSQL"**
2. Name: `munda-market-db`
3. Region: Same as backend
4. Plan: Starter ($7/month)
5. Copy the **Internal Database URL**

#### D. Set Environment Variables
In your web service settings, add:

```bash
# Required
DATABASE_URL=<from PostgreSQL service>
SECRET_KEY=<auto-generated by Render>
DEBUG=false
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# CORS
ALLOWED_HOSTS=admin.mundamarket.co.zw,buy.mundamarket.co.zw

# Optional - Payment Gateways
STRIPE_SECRET_KEY=sk_live_xxx
ECOCASH_API_KEY=xxx
ZIPIT_API_KEY=xxx

# Optional - Messaging
WHATSAPP_ACCESS_TOKEN=xxx
TWILIO_ACCOUNT_SID=xxx
TWILIO_AUTH_TOKEN=xxx
TWILIO_PHONE_NUMBER=+1234567890
```

#### E. Custom Domain (Optional)
1. Go to **Settings** â†’ **Custom Domains**
2. Add: `api.mundamarket.co.zw`
3. Update DNS:
   ```
   Type: CNAME
   Name: api
   Value: munda-market-api.onrender.com
   ```

#### F. Database Setup
After first deployment, run migrations:
```bash
# In Render Shell
cd backend
python init_db.py
```

---

## 2ï¸âƒ£ Admin Console Deployment (Vercel)

### Prerequisites
- Vercel account (free tier)
- GitHub repository

### Steps:

#### A. Deploy to Vercel
1. Go to [vercel.com](https://vercel.com)
2. Click **"Add New"** â†’ **"Project"**
3. Import your GitHub repository
4. Select the `admin-console` folder

#### B. Configure Build
```
Framework Preset:    Vite
Build Command:       npm run build
Output Directory:    dist
Install Command:     npm install
Root Directory:      admin-console
```

#### C. Environment Variables
```
VITE_API_BASE_URL=https://api.mundamarket.co.zw
```

#### D. Custom Domain
1. Go to **Settings** â†’ **Domains**
2. Add: `admin.mundamarket.co.zw`
3. Vercel provides SSL automatically âœ…

---

## 3ï¸âƒ£ Buyer Portal Deployment (Vercel)

### Steps (same as Admin Console):

#### A. Deploy to Vercel
1. New project from same repository
2. Select `buyer-portal` folder

#### B. Configure Build
```
Framework Preset:    Create React App
Build Command:       npm run build
Output Directory:    build
Install Command:     npm install
Root Directory:      buyer-portal
```

#### C. Environment Variables
```
REACT_APP_API_URL=https://api.mundamarket.co.zw
```

#### D. Custom Domain
Add: `buy.mundamarket.co.zw` or `market.mundamarket.co.zw`

---

## 4ï¸âƒ£ Flutter App Deployment (Google Play Store)

### Prerequisites
- Google Play Console account ($25 one-time fee)
- Signing key for Android
- App Bundle (AAB) file

### Steps:

#### A. Build Release APK/AAB
```bash
cd farmer-app

# For Play Store (AAB)
flutter build appbundle --release

# For Direct Download (APK)
flutter build apk --release
```

#### B. Sign the App
Create keystore:
```bash
keytool -genkey -v -keystore munda-market.jks -keyalg RSA -keysize 2048 -validity 10000 -alias munda
```

Add to `android/key.properties`:
```properties
storePassword=<your-password>
keyPassword=<your-password>
keyAlias=munda
storeFile=../munda-market.jks
```

#### C. Upload to Play Store
1. Create app in [Google Play Console](https://play.google.com/console)
2. Upload AAB file
3. Fill in store listing:
   - Title: "Munda Market - Farmer App"
   - Description: Your app description
   - Screenshots: At least 2 required
   - Privacy policy URL
4. Submit for review

#### D. Direct APK Distribution (Zimbabwe)
Host APK on your domain:
```
https://download.mundamarket.co.zw/munda-farmer-app.apk
```

Users can download directly (enable "Unknown Sources" on Android)

---

## ğŸ”’ Security Checklist

### Before Production:

#### Backend:
- [ ] Change `SECRET_KEY` (use Render's auto-generate)
- [ ] Set `DEBUG=false`
- [ ] Configure CORS properly (specific domains only)
- [ ] Enable HTTPS only
- [ ] Set up database backups (Render automatic)
- [ ] Configure rate limiting
- [ ] Set up monitoring (Render logs)

#### Frontend:
- [ ] Remove console.log statements
- [ ] Enable production builds
- [ ] Configure CSP headers
- [ ] Set up error tracking (Sentry)
- [ ] Enable analytics (optional)

#### Mobile:
- [ ] Use HTTPS endpoints only
- [ ] Obfuscate app code
- [ ] Enable Google Play Protect
- [ ] Add SSL pinning (optional)

---

## ğŸ“Š Monitoring & Logging

### Render.com (Backend):
```bash
# View logs
render logs --tail

# Access shell
render shell munda-market-api

# View metrics
Dashboard â†’ Metrics â†’ CPU, Memory, Requests
```

### Vercel (Frontend):
- Real-time logs in dashboard
- Analytics available on Pro plan
- Performance insights

### Recommended Add-ons:
- **Sentry** - Error tracking (both frontend & backend)
- **LogRocket** - Session replay (frontend)
- **Better Stack** - Log aggregation
- **Uptime Robot** - Uptime monitoring (free)

---

## ğŸ’° Total Monthly Cost Estimate

### Starter Setup (First 6 months):
```
Render Backend:         $7/month
Render PostgreSQL:      $7/month
Vercel (2 sites):       $0/month (free tier)
Google Play:            $25 (one-time)
Domain:                 $12/year
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Monthly:                $15/month
First Year Total:       ~$200
```

### Production Scale (1000+ users):
```
Render Backend:         $25/month (Standard - 2GB RAM)
Render PostgreSQL:      $20/month (Standard - 1GB)
Render Redis:           $10/month (if needed)
Vercel Pro:             $20/month (analytics, more bandwidth)
Domain:                 $12/year
Monitoring:             $20/month (Sentry)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Monthly:                ~$95/month
```

---

## ğŸš€ Quick Deploy Commands

### Deploy Backend to Render:
```bash
# 1. Push to GitHub
git add .
git commit -m "Ready for deployment"
git push origin main

# 2. Render auto-deploys from GitHub
# 3. Monitor deployment in Render dashboard
```

### Deploy Frontend to Vercel:
```bash
# Install Vercel CLI
npm i -g vercel

# Deploy Admin Console
cd admin-console
vercel --prod

# Deploy Buyer Portal
cd ../buyer-portal
vercel --prod
```

### Build Flutter App:
```bash
cd farmer-app

# Build for release
flutter build appbundle --release

# Output: build/app/outputs/bundle/release/app-release.aab
```

---

## ğŸ”„ CI/CD Pipeline (Recommended)

### GitHub Actions (Free)
Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Trigger Render Deploy
        run: curl ${{ secrets.RENDER_DEPLOY_HOOK }}
  
  deploy-admin:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./admin-console
```

---

## ğŸ“± Flutter Distribution Options

### Option 1: Google Play Store (Recommended)
**Pros:**
- âœ… Automatic updates
- âœ… User trust & security
- âœ… Payment processing (if needed)
- âœ… Analytics & crash reports

**Cons:**
- âš ï¸ $25 one-time fee
- âš ï¸ Review process (1-3 days)
- âš ï¸ Google's policies

### Option 2: Direct APK Download
**Pros:**
- âœ… Immediate availability
- âœ… No store fees
- âœ… Full control

**Cons:**
- âš ï¸ Users must enable "Unknown Sources"
- âš ï¸ No automatic updates
- âš ï¸ Security warnings

**Recommendation:** Use both:
- Play Store for primary distribution
- Direct APK for testing & immediate access

---

## ğŸŒ Domain Setup

### DNS Configuration:

```
# Main domain
mundamarket.co.zw           â†’  Buyer Portal (Vercel)

# Subdomains
api.mundamarket.co.zw       â†’  Backend (Render CNAME)
admin.mundamarket.co.zw     â†’  Admin Console (Vercel CNAME)
buy.mundamarket.co.zw       â†’  Buyer Portal (Vercel CNAME)
download.mundamarket.co.zw  â†’  APK hosting (Vercel static)
```

### SSL Certificates:
- âœ… Vercel: Automatic (Let's Encrypt)
- âœ… Render: Automatic (Let's Encrypt)
- âœ… No configuration needed!

---

## âœ… Pre-Deployment Checklist

### Backend:
- [ ] Update `requirements-core.txt` with all dependencies
- [ ] Set all environment variables in Render
- [ ] Test database migrations
- [ ] Configure CORS for production domains
- [ ] Set up error logging
- [ ] Create initial admin user
- [ ] Test all API endpoints

### Admin Console:
- [ ] Update API URL to production
- [ ] Remove debug logs
- [ ] Test all pages
- [ ] Verify authentication flow
- [ ] Test dark mode
- [ ] Check mobile responsiveness

### Buyer Portal:
- [ ] Update API URL to production
- [ ] Test checkout flow
- [ ] Verify payment integration
- [ ] Test mobile responsiveness

### Flutter App:
- [ ] Update API URL in code
- [ ] Test on real devices
- [ ] Create app icons (all sizes)
- [ ] Write app description
- [ ] Create screenshots
- [ ] Set version number
- [ ] Sign the app

---

## ğŸ¯ Post-Deployment Tasks

### Week 1:
1. Monitor error logs
2. Check performance metrics
3. Verify all integrations working
4. Test payment flows end-to-end
5. Onboard first farmers/buyers

### Ongoing:
- Monitor uptime (set up alerts)
- Review audit logs weekly
- Database backups (Render automatic)
- Update dependencies monthly
- Security patches as needed

---

## ğŸ“ Support Resources

### Render.com:
- Docs: https://render.com/docs
- Community: https://community.render.com
- Status: https://status.render.com

### Vercel:
- Docs: https://vercel.com/docs
- Community: https://github.com/vercel/vercel/discussions
- Status: https://vercel-status.com

### Flutter:
- Docs: https://docs.flutter.dev/deployment/android
- Play Console: https://play.google.com/console

---

## ğŸ‰ You're Ready to Deploy!

Your stack is **production-ready** with:
- âœ… Backend configured for Render
- âœ… Frontends configured for Vercel
- âœ… Mobile app ready for Play Store
- âœ… All environment configs included
- âœ… Security best practices
- âœ… Monitoring setup
- âœ… Cost-effective architecture

**Total setup time: ~2 hours**
**Monthly cost: $14-15 to start**

Good luck with your launch! ğŸš€ğŸŒ¾

